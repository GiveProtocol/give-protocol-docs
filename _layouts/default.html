<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />

    <!-- Security Headers -->
    <meta
      http-equiv="Content-Security-Policy"
      content="{{ site.security.content_security_policy | strip }}"
    />
    <meta http-equiv="X-Content-Type-Options" content="nosniff" />
    <meta http-equiv="X-Frame-Options" content="DENY" />
    <meta http-equiv="X-XSS-Protection" content="1; mode=block" />
    <meta
      http-equiv="Referrer-Policy"
      content="strict-origin-when-cross-origin"
    />

    <title>
      {% if page.title %}{{ page.title }} - {{ site.title }}{% else %}{{
      site.title }}{% endif %}
    </title>
    <meta
      name="description"
      content="{% if page.description %}{{ page.description }}{% else %}{{ site.description }}{% endif %}"
    />

    <!-- Google tag (gtag.js) -->
    <script
      async
      src="https://www.googletagmanager.com/gtag/js?id=G-CBQHKLHD8T"
    ></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag() {
        dataLayer.push(arguments);
      }
      gtag("js", new Date());
      gtag("config", "G-CBQHKLHD8T");
    </script>

    <!-- Canonical URL -->
    <link rel="canonical" href="{{ page.url | absolute_url }}" />

    <!-- Open Graph / Facebook -->
    <meta property="og:type" content="website" />
    <meta property="og:url" content="{{ page.url | absolute_url }}" />
    <meta
      property="og:title"
      content="{% if page.title %}{{ page.title }} - {{ site.title }}{% else %}{{ site.title }}{% endif %}"
    />
    <meta
      property="og:description"
      content="{% if page.description %}{{ page.description }}{% else %}{{ site.description }}{% endif %}"
    />
    <meta
      property="og:image"
      content="{{ '/assets/images/logo.svg' | absolute_url }}"
    />

    <!-- Twitter -->
    <meta property="twitter:card" content="summary_large_image" />
    <meta property="twitter:url" content="{{ page.url | absolute_url }}" />
    <meta
      property="twitter:title"
      content="{% if page.title %}{{ page.title }} - {{ site.title }}{% else %}{{ site.title }}{% endif %}"
    />
    <meta
      property="twitter:description"
      content="{% if page.description %}{{ page.description }}{% else %}{{ site.description }}{% endif %}"
    />
    <meta
      property="twitter:image"
      content="{{ '/assets/images/logo.svg' | absolute_url }}"
    />

    <!-- Favicon -->
    <link
      rel="icon"
      type="image/svg+xml"
      href="{{ '/assets/images/logo.svg' | relative_url }}"
    />

    <!-- Preconnect to external domains for performance -->
    <link rel="preconnect" href="https://fonts.googleapis.com" />

    <!-- Stylesheets -->
    <link rel="stylesheet" href="{{ '/assets/css/main.css' | relative_url }}?v=2025-11-12-v5" />

    <!-- Search JavaScript -->
    <script src="{{ '/assets/js/simple-jekyll-search.min.js' | relative_url }}"></script>

    <!-- Google Translate -->
    <script type="text/javascript">
      function googleTranslateElementInit() {
        try {
          if (
            typeof google !== "undefined" &&
            google.translate &&
            google.translate.TranslateElement
          ) {
            new google.translate.TranslateElement(
              {
                pageLanguage: "en",
                includedLanguages: "en,es,de,fr,ja,zh-CN,zh-TW,th,vi,ko,ar,hi",
                layout: google.translate.TranslateElement.InlineLayout.SIMPLE,
                autoDisplay: false,
              },
              "google_translate_element",
            );
          }
        } catch (e) {
          console.warn("Google Translate initialization error:", e);
        }
      }
    </script>
    <script
      type="text/javascript"
      src="//translate.google.com/translate_a/element.js?cb=googleTranslateElementInit"
    ></script>

    <!-- JSON-LD Schema for SEO -->
    <script type="application/ld+json">
      {
        "@context": "https://schema.org",
        "@type": "WebSite",
        "name": "{{ site.title }}",
        "description": "{{ site.description }}",
        "url": "{{ site.url }}",
        "potentialAction": {
          "@type": "SearchAction",
          "target": "{{ site.url }}/search?q={search_term_string}",
          "query-input": "required name=search_term_string"
        }
      }
    </script>
  </head>
  <body>
    <!-- Skip to main content link for accessibility -->
    <a href="#main-content" class="skip-link">Skip to main content</a>

    <!-- Hidden Google Translate Element -->
    <div id="google_translate_element" style="display: none"></div>

    <div class="site">
      <!-- Header with same background color as page -->
      <header class="site-header" role="banner">
        <div class="header-content">
          <a
            href="{{ '/' | relative_url }}"
            class="site-title"
            aria-label="Give Protocol Documentation Home"
          >
            <img
              src="{{ '/assets/images/logo.svg' | relative_url }}"
              alt="Give Protocol"
              class="logo"
            />
            <span>Give Protocol Docs</span>
          </a>

          <nav
            class="header-nav"
            role="navigation"
            aria-label="Header navigation"
          >
            <a href="https://giveprotocol.io" class="btn btn-ghost"
              >Main Site</a
            >

            <!-- Settings Dropdown -->
            <div class="settings-dropdown">
              <button
                class="settings-toggle btn btn-ghost"
                aria-label="Settings"
                aria-expanded="false"
                aria-haspopup="true"
              >
                <svg
                  width="20"
                  height="20"
                  viewBox="0 0 24 24"
                  fill="none"
                  stroke="currentColor"
                  stroke-width="2"
                  stroke-linecap="round"
                  stroke-linejoin="round"
                >
                  <path
                    d="M12.22 2h-.44a2 2 0 0 0-2 2v.18a2 2 0 0 1-1 1.73l-.43.25a2 2 0 0 1-2 0l-.15-.08a2 2 0 0 0-2.73.73l-.22.38a2 2 0 0 0 .73 2.73l.15.1a2 2 0 0 1 1 1.72v.51a2 2 0 0 1-1 1.74l-.15.09a2 2 0 0 0-.73 2.73l.22.38a2 2 0 0 0 2.73.73l.15-.08a2 2 0 0 1 2 0l.43.25a2 2 0 0 1 1 1.73V20a2 2 0 0 0 2 2h.44a2 2 0 0 0 2-2v-.18a2 2 0 0 1 1-1.73l.43-.25a2 2 0 0 1 2 0l.15.08a2 2 0 0 0 2.73-.73l.22-.39a2 2 0 0 0-.73-2.73l-.15-.08a2 2 0 0 1-1-1.74v-.5a2 2 0 0 1 1-1.74l.15-.09a2 2 0 0 0 .73-2.73l-.22-.38a2 2 0 0 0-2.73-.73l-.15.08a2 2 0 0 1-2 0l-.43-.25a2 2 0 0 1-1-1.73V4a2 2 0 0 0-2-2z"
                  ></path>
                  <circle cx="12" cy="12" r="3"></circle>
                </svg>
                <span class="settings-title">Settings</span>
              </button>

              <div class="settings-menu" role="menu" aria-hidden="true">
                <div class="settings-section">
                  <h4 class="settings-heading theme-heading">Theme</h4>
                  <div class="theme-options">
                    <button
                      class="theme-option active"
                      data-theme="light"
                      role="menuitem"
                    >
                      <svg
                        width="16"
                        height="16"
                        viewBox="0 0 24 24"
                        fill="none"
                        stroke="currentColor"
                        stroke-width="2"
                        stroke-linecap="round"
                        stroke-linejoin="round"
                      >
                        <circle cx="12" cy="12" r="4"></circle>
                        <path d="m12 2v2"></path>
                        <path d="m12 20v2"></path>
                        <path d="m4.93 4.93 1.41 1.41"></path>
                        <path d="m17.66 17.66 1.41 1.41"></path>
                        <path d="M2 12h2"></path>
                        <path d="M20 12h2"></path>
                        <path d="m6.34 17.66-1.41 1.41"></path>
                        <path d="m19.07 4.93-1.41 1.41"></path>
                      </svg>
                      Light
                    </button>
                    <button
                      class="theme-option"
                      data-theme="dark"
                      role="menuitem"
                    >
                      <svg
                        width="16"
                        height="16"
                        viewBox="0 0 24 24"
                        fill="none"
                        stroke="currentColor"
                        stroke-width="2"
                        stroke-linecap="round"
                        stroke-linejoin="round"
                      >
                        <path d="M12 3a6 6 0 0 0 9 9 9 9 0 1 1-9-9Z"></path>
                      </svg>
                      Dark
                    </button>
                  </div>
                </div>

                <div class="settings-section">
                  <h4 class="settings-heading language-heading">Language</h4>
                  <div class="language-options">
                    <button
                      class="language-option active"
                      data-lang="en"
                      role="menuitem"
                    >
                      <span class="flag">üá∫üá∏</span>
                      English
                    </button>
                    <button
                      class="language-option"
                      data-lang="es"
                      role="menuitem"
                    >
                      <span class="flag">üá™üá∏</span>
                      Espa√±ol
                    </button>
                    <button
                      class="language-option"
                      data-lang="de"
                      role="menuitem"
                    >
                      <span class="flag">üá©üá™</span>
                      Deutsch
                    </button>
                    <button
                      class="language-option"
                      data-lang="fr"
                      role="menuitem"
                    >
                      <span class="flag">üá´üá∑</span>
                      Fran√ßais
                    </button>
                    <button
                      class="language-option"
                      data-lang="ja"
                      role="menuitem"
                    >
                      <span class="flag">üáØüáµ</span>
                      Êó•Êú¨Ë™û
                    </button>
                    <button
                      class="language-option"
                      data-lang="zh-CN"
                      role="menuitem"
                    >
                      <span class="flag">üá®üá≥</span>
                      ÁÆÄ‰Ωì‰∏≠Êñá
                    </button>
                    <button
                      class="language-option"
                      data-lang="zh-TW"
                      role="menuitem"
                    >
                      <span class="flag">üáπüáº</span>
                      ÁπÅÈ´î‰∏≠Êñá
                    </button>
                    <button
                      class="language-option"
                      data-lang="th"
                      role="menuitem"
                    >
                      <span class="flag">üáπüá≠</span>
                      ‡πÑ‡∏ó‡∏¢
                    </button>
                    <button
                      class="language-option"
                      data-lang="vi"
                      role="menuitem"
                    >
                      <span class="flag">üáªüá≥</span>
                      Ti·∫øng Vi·ªát
                    </button>
                    <button
                      class="language-option"
                      data-lang="ko"
                      role="menuitem"
                    >
                      <span class="flag">üá∞üá∑</span>
                      ÌïúÍµ≠Ïñ¥
                    </button>
                    <button
                      class="language-option"
                      data-lang="ar"
                      role="menuitem"
                    >
                      <span class="flag">üá∏üá¶</span>
                      ÿßŸÑÿπÿ±ÿ®Ÿäÿ©
                    </button>
                    <button
                      class="language-option"
                      data-lang="hi"
                      role="menuitem"
                    >
                      <span class="flag">üáÆüá≥</span>
                      ‡§π‡§ø‡§®‡•ç‡§¶‡•Ä
                    </button>
                  </div>
                </div>
              </div>
            </div>
          </nav>

          <button
            class="mobile-menu-toggle"
            aria-label="Toggle mobile menu"
            aria-expanded="false"
            aria-controls="mobile-menu"
          >
            <svg
              class="menu-icon"
              width="24"
              height="24"
              viewBox="0 0 24 24"
              fill="none"
              stroke="currentColor"
              stroke-width="2"
              stroke-linecap="round"
              stroke-linejoin="round"
            >
              <line x1="3" y1="6" x2="21" y2="6"></line>
              <line x1="3" y1="12" x2="21" y2="12"></line>
              <line x1="3" y1="18" x2="21" y2="18"></line>
            </svg>
          </button>
        </div>
      </header>

      <!-- Main content area -->
      <main class="site-main">
        <!-- Sidebar navigation -->
        <aside
          class="sidebar"
          role="navigation"
          aria-label="Documentation navigation"
        >
          <!-- Search -->
          <div class="search-container">
            <input
              type="text"
              class="search-input"
              id="search-input"
              placeholder="Search documentation..."
              aria-label="Search documentation"
              title="Search documentation..."
            />
            <svg
              class="search-icon"
              width="16"
              height="16"
              viewBox="0 0 24 24"
              fill="none"
              stroke="currentColor"
              stroke-width="2"
              stroke-linecap="round"
              stroke-linejoin="round"
            >
              <circle cx="11" cy="11" r="8"></circle>
              <path d="m21 21-4.35-4.35"></path>
            </svg>
            <div class="search-results" id="search-results"></div>
          </div>

          <!-- Navigation -->
          <nav class="site-nav">
            <div class="nav-section">
              <h3 class="nav-heading">Getting Started</h3>
              <ul class="nav-list">
                <li class="nav-item">
                  <a
                    href="{{ '/introduction/what-is-give-protocol/' | relative_url }}"
                    class="nav-link"
                    >What is Give Protocol?</a
                  >
                </li>
                <li class="nav-item">
                  <a
                    href="{{ '/introduction/how-to-join/' | relative_url }}"
                    class="nav-link"
                    >How to Join</a
                  >
                </li>
                <li class="nav-item">
                  <a
                    href="{{ '/getting-started/creating-account/' | relative_url }}"
                    class="nav-link"
                    >Creating Account</a
                  >
                </li>
                <li class="nav-item">
                  <a
                    href="{{ '/getting-started/wallet-connection/' | relative_url }}"
                    class="nav-link"
                    >Wallet Connection</a
                  >
                </li>
                <li class="nav-item">
                  <a
                    href="{{ '/getting-started/first-steps/' | relative_url }}"
                    class="nav-link"
                    >First Steps</a
                  >
                </li>
                <li class="nav-item">
                  <a
                    href="{{ '/getting-started/dashboard/' | relative_url }}"
                    class="nav-link"
                    >Dashboard Guide</a
                  >
                </li>
              </ul>
            </div>

            <div class="nav-section">
              <h3 class="nav-heading">User Guides</h3>
              <ul class="nav-list">
                <li class="nav-item">
                  <a
                    href="{{ '/user-guides/donors/' | relative_url }}"
                    class="nav-link"
                    >For Donors</a
                  >
                </li>
                <li class="nav-item">
                  <a
                    href="{{ '/user-guides/organizations/' | relative_url }}"
                    class="nav-link"
                    >For Organizations</a
                  >
                </li>
                <li class="nav-item">
                  <a
                    href="{{ '/user-guides/volunteers/' | relative_url }}"
                    class="nav-link"
                    >For Volunteers</a
                  >
                </li>
              </ul>
            </div>

            <div class="nav-section">
              <h3 class="nav-heading">Platform Features</h3>
              <ul class="nav-list">
                <li class="nav-item">
                  <a
                    href="{{ '/platform-features/verification/' | relative_url }}"
                    class="nav-link"
                    >Verification System</a
                  >
                </li>
                <li class="nav-item">
                  <a
                    href="{{ '/platform-features/search-discovery/' | relative_url }}"
                    class="nav-link"
                    >Search & Discovery</a
                  >
                </li>
              </ul>
            </div>

            <div class="nav-section">
              <h3 class="nav-heading">Resources</h3>
              <ul class="nav-list">
                <li class="nav-item">
                  <a
                    href="{{ '/resources/time-tracking/' | relative_url }}"
                    class="nav-link"
                    >Time Tracking</a
                  >
                </li>
                <li class="nav-item">
                  <a
                    href="{{ '/resources/calculator/' | relative_url }}"
                    class="nav-link"
                    >Impact Calculator</a
                  >
                </li>
              </ul>
            </div>

            <div class="nav-section">
              <h3 class="nav-heading">Safety & Security</h3>
              <ul class="nav-list">
                <li class="nav-item">
                  <a
                    href="{{ '/safety-security/platform-security/' | relative_url }}"
                    class="nav-link"
                    >Platform Security</a
                  >
                </li>
                <li class="nav-item">
                  <a
                    href="{{ '/safety-security/smart-giving/' | relative_url }}"
                    class="nav-link"
                    >Smart Giving</a
                  >
                </li>
                <li class="nav-item">
                  <a
                    href="{{ '/safety-security/volunteer-safety/' | relative_url }}"
                    class="nav-link"
                    >Volunteer Safety</a
                  >
                </li>
              </ul>
            </div>

            <div class="nav-section">
              <h3 class="nav-heading">Technical</h3>
              <ul class="nav-list">
                <li class="nav-item">
                  <a
                    href="{{ '/technical/cryptocurrencies/' | relative_url }}"
                    class="nav-link"
                    >Cryptocurrencies</a
                  >
                </li>
                <li class="nav-item">
                  <a
                    href="{{ '/technical/fees/' | relative_url }}"
                    class="nav-link"
                    >Fee Structure</a
                  >
                </li>
              </ul>
            </div>

            <div class="nav-section">
              <h3 class="nav-heading">Community</h3>
              <ul class="nav-list">
                <li class="nav-item">
                  <a
                    href="{{ '/community/forums/' | relative_url }}"
                    class="nav-link"
                    >Forums</a
                  >
                </li>
                <li class="nav-item">
                  <a
                    href="{{ '/community/social/' | relative_url }}"
                    class="nav-link"
                    >Social Impact</a
                  >
                </li>
                <li class="nav-item">
                  <a
                    href="{{ '/community/contact/' | relative_url }}"
                    class="nav-link"
                    >Contact Us</a
                  >
                </li>
              </ul>
            </div>

            <div class="nav-section">
              <h3 class="nav-heading">Help & Support</h3>
              <ul class="nav-list">
                <li class="nav-item">
                  <a
                    href="{{ '/help-center/faq/' | relative_url }}"
                    class="nav-link"
                    >FAQ</a
                  >
                </li>
                <li class="nav-item">
                  <a
                    href="{{ '/help-center/need-help/' | relative_url }}"
                    class="nav-link"
                    >Need Help?</a
                  >
                </li>
                <li class="nav-item">
                  <a
                    href="{{ '/help-center/report-issue/' | relative_url }}"
                    class="nav-link"
                    >Report Issue</a
                  >
                </li>
              </ul>
            </div>
          </nav>
        </aside>

        <!-- Main content -->
        <div class="main-content" id="main-content" role="main">
          <!-- Breadcrumbs -->
          {% if page.url != "/" %}
          <nav class="breadcrumbs" aria-label="Breadcrumb">
            <ol class="breadcrumb-list">
              <li class="breadcrumb-item">
                <a href="{{ '/' | relative_url }}">Home</a>
              </li>
              {% assign crumbs = page.url | remove:'/index.html' | split: '/' %}
              {% for crumb in crumbs offset: 1 %} {% unless forloop.last %}
              <li class="breadcrumb-item">
                {% capture crumb_url %}{% for c in crumbs limit: forloop.index
                %}{{ c | append: '/' }}{% endfor %}{% endcapture %}
                <a href="{{ crumb_url | relative_url }}"
                  >{{ crumb | replace:'-',' ' | capitalize }}</a
                >
              </li>
              {% else %}
              <li class="breadcrumb-item">
                {{ crumb | replace:'-',' ' | capitalize }}
              </li>
              {% endunless %} {% endfor %}
            </ol>
          </nav>
          {% endif %}

          <!-- Page header -->
          {% if page.title %}
          <header class="page-header">
            <h1 class="page-title">{{ page.title }}</h1>
            {% if page.description %}
            <p class="page-description">{{ page.description }}</p>
            {% endif %} {% if page.date or page.last_modified_at %}
            <div class="page-meta">
              {% if page.date %}
              <div class="meta-item">
                <svg
                  width="16"
                  height="16"
                  viewBox="0 0 24 24"
                  fill="none"
                  stroke="currentColor"
                  stroke-width="2"
                  stroke-linecap="round"
                  stroke-linejoin="round"
                >
                  <rect x="3" y="4" width="18" height="18" rx="2" ry="2"></rect>
                  <line x1="16" y1="2" x2="16" y2="6"></line>
                  <line x1="8" y1="2" x2="8" y2="6"></line>
                  <line x1="3" y1="10" x2="21" y2="10"></line>
                </svg>
                Published: {{ page.date | date: "%B %d, %Y" }}
              </div>
              {% endif %} {% if page.last_modified_at %}
              <div class="meta-item">
                <svg
                  width="16"
                  height="16"
                  viewBox="0 0 24 24"
                  fill="none"
                  stroke="currentColor"
                  stroke-width="2"
                  stroke-linecap="round"
                  stroke-linejoin="round"
                >
                  <polyline points="23 4 23 10 17 10"></polyline>
                  <polyline points="1 20 1 14 7 14"></polyline>
                  <path
                    d="m3.51 9a9 9 0 0 1 14.85-3.36L23 10M1 14l4.64 4.36A9 9 0 0 0 20.49 15"
                  ></path>
                </svg>
                Updated: {{ page.last_modified_at | date: "%B %d, %Y" }}
              </div>
              {% endif %}
            </div>
            {% endif %}
          </header>
          {% endif %}

          <!-- Article content -->
          <article class="article-content">{{ content }}</article>

          <!-- Edit this page link -->
          {% if page.path %}
          <div class="mt-6 pt-4 border-top">
            <a
              href="https://github.com/GiveProtocol/Duration-Give/edit/main/docs/{{ page.path }}"
              class="btn btn-ghost btn-sm"
              target="_blank"
              rel="noopener"
            >
              <svg
                class="btn-icon"
                width="16"
                height="16"
                viewBox="0 0 24 24"
                fill="none"
                stroke="currentColor"
                stroke-width="2"
                stroke-linecap="round"
                stroke-linejoin="round"
              >
                <path
                  d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"
                ></path>
                <path
                  d="m18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"
                ></path>
              </svg>
              Edit this page
            </a>
          </div>
          {% endif %}
        </div>
      </main>

      <!-- Footer with enhanced copyright and privacy links -->
      <footer class="site-footer" role="contentinfo">
        <div class="footer-content">
          <div class="footer-text">
            ¬© 2025 Give Protocol. All rights reserved.
            <span class="footer-divider">|</span>
            Building transparent charitable giving on blockchain technology.
          </div>
          <nav class="footer-links" aria-label="Footer navigation">
            <a href="https://giveprotocol.io">Main Site</a>
            <a href="https://giveprotocol.io/privacy">Privacy Policy</a>
            <a href="https://giveprotocol.io/terms">Terms of Service</a>
            <a href="https://github.com/GiveProtocol/Duration-Give">GitHub</a>
          </nav>
        </div>
      </footer>
    </div>

    <!-- Mobile menu -->
    <div class="mobile-menu" id="mobile-menu" aria-hidden="true">
      <nav class="mobile-nav" role="navigation" aria-label="Mobile navigation">
        <!-- Same navigation structure as sidebar -->
        <div class="nav-section">
          <h3 class="nav-heading">Getting Started</h3>
          <ul class="nav-list">
            <li class="nav-item">
              <a
                href="{{ '/introduction/what-is-give-protocol/' | relative_url }}"
                class="nav-link"
                >What is Give Protocol?</a
              >
            </li>
            <li class="nav-item">
              <a
                href="{{ '/introduction/how-to-join/' | relative_url }}"
                class="nav-link"
                >How to Join</a
              >
            </li>
            <li class="nav-item">
              <a
                href="{{ '/getting-started/creating-account/' | relative_url }}"
                class="nav-link"
                >Creating Account</a
              >
            </li>
            <li class="nav-item">
              <a
                href="{{ '/getting-started/wallet-connection/' | relative_url }}"
                class="nav-link"
                >Wallet Connection</a
              >
            </li>
            <li class="nav-item">
              <a
                href="{{ '/getting-started/first-steps/' | relative_url }}"
                class="nav-link"
                >First Steps</a
              >
            </li>
            <li class="nav-item">
              <a
                href="{{ '/getting-started/dashboard/' | relative_url }}"
                class="nav-link"
                >Dashboard Guide</a
              >
            </li>
          </ul>
        </div>
        <!-- Include other nav sections here for mobile -->
      </nav>
    </div>

    <!-- JavaScript for interactive features -->
    <script>
      /* global google, SimpleJekyllSearch */
      // Theme and settings management
      function initSettings() {
        // Get saved preferences or defaults
        const savedTheme = localStorage.getItem("docs-theme") || "light";
        const savedLang = localStorage.getItem("docs-language") || "en";

        applyTheme(savedTheme);
        applyLanguage(savedLang);
        updateSettingsUI();
      }

      function applyTheme(theme) {
        const body = document.body;

        if (theme === "dark") {
          body.classList.add("dark-mode");
        } else {
          body.classList.remove("dark-mode");
        }

        localStorage.setItem("docs-theme", theme);
      }

      function applyLanguage(lang) {
        // Save preference
        localStorage.setItem("docs-language", lang);
        console.log("Applying language:", lang); // Debug log

        // Only trigger translation if user explicitly changed language
        // Don't auto-translate on page load to prevent refresh loops
        if (window.userRequestedLanguageChange) {
          console.log("User requested language change to:", lang); // Debug log

          if (lang === "en") {
            // Reset to original English without refresh
            if (window.location.hash.includes("googtrans")) {
              console.log("Resetting to English"); // Debug log
              window.location.href =
                window.location.pathname + window.location.search;
            }
          } else {
            // Use Google Translate API to change language
            console.log("Triggering Google Translate for:", lang); // Debug log
            triggerGoogleTranslate(lang);
          }
          window.userRequestedLanguageChange = false;
        }
      }

      function triggerGoogleTranslate(targetLang) {
        // Wait for Google Translate to be ready
        if (
          typeof google !== "undefined" &&
          google.translate &&
          google.translate.TranslateElement
        ) {
          try {
            // Method 1: Try to use the URL hash method first as it's most reliable
            if (targetLang === "en") {
              // Reset to original English
              if (window.location.hash.includes("googtrans")) {
                window.location.href =
                  window.location.pathname + window.location.search;
                return;
              }
            } else {
              // Use Google Translate hash to trigger translation
              const currentUrl =
                window.location.pathname + window.location.search;
              window.location.href =
                currentUrl + "#googtrans(en|" + targetLang + ")";
              return;
            }
          } catch (e) {
            console.warn("Google Translate hash method failed", e);
          }

          // Method 2: Try to find and trigger the select element
          try {
            const selectElement = document.querySelector(
              "#google_translate_element select",
            );
            if (selectElement) {
              selectElement.value = targetLang;
              selectElement.dispatchEvent(new Event("change"));
              return;
            }
          } catch (e) {
            console.warn("Select element method failed", e);
          }

          // Method 3: Try the iframe method with better error handling
          setTimeout(() => {
            try {
              const iframe = document.querySelector(".goog-te-menu-frame");
              if (iframe) {
                const iframeDoc =
                  iframe.contentDocument || iframe.contentWindow.document;
                const langLink = iframeDoc.querySelector(
                  `[data-value="${targetLang}"]`,
                );
                if (langLink) {
                  langLink.click();
                  return;
                }
              }
            } catch (e) {
              console.warn("Iframe method failed (likely cross-origin)", e);
            }

            // Final fallback: Force reload with hash
            const currentUrl =
              window.location.pathname + window.location.search;
            window.location.href =
              currentUrl + "#googtrans(en|" + targetLang + ")";
          }, 500);
        } else {
          // Google Translate not loaded yet, wait and retry (max 3 attempts)
          const maxRetries = 3;
          const retryCount = window.translateRetryCount || 0;

          if (retryCount < maxRetries) {
            window.translateRetryCount = retryCount + 1;
            setTimeout(() => {
              triggerGoogleTranslate(targetLang);
            }, 1000);
          } else {
            console.warn(
              "Google Translate failed to load after",
              maxRetries,
              "attempts",
            );
            // Final fallback even if Google Translate isn't loaded
            const currentUrl =
              window.location.pathname + window.location.search;
            window.location.href =
              currentUrl + "#googtrans(en|" + targetLang + ")";
          }
        }
      }

      function updateSettingsUI() {
        const savedTheme = localStorage.getItem("docs-theme") || "light";
        const savedLang = localStorage.getItem("docs-language") || "en";

        // Update theme option active states
        document.querySelectorAll(".theme-option").forEach((option) => {
          option.classList.toggle(
            "active",
            option.dataset.theme === savedTheme,
          );
        });

        // Update language option active states
        document.querySelectorAll(".language-option").forEach((option) => {
          option.classList.toggle("active", option.dataset.lang === savedLang);
        });
      }

      function toggleSettingsMenu() {
        const settingsMenu = document.querySelector(".settings-menu");
        const settingsToggle = document.querySelector(".settings-toggle");

        if (settingsMenu && settingsToggle) {
          const isOpen = settingsMenu.classList.contains("open");
          settingsMenu.classList.toggle("open");
          settingsToggle.setAttribute("aria-expanded", !isOpen);
          settingsMenu.setAttribute("aria-hidden", isOpen);
        }
      }

      // Close settings menu when clicking outside
      function closeSettingsOnOutsideClick(event) {
        const settingsDropdown = document.querySelector(".settings-dropdown");
        const settingsMenu = document.querySelector(".settings-menu");

        if (
          settingsDropdown &&
          settingsMenu &&
          !settingsDropdown.contains(event.target)
        ) {
          settingsMenu.classList.remove("open");
          document
            .querySelector(".settings-toggle")
            .setAttribute("aria-expanded", "false");
          settingsMenu.setAttribute("aria-hidden", "true");
        }
      }

      // Initialize settings immediately to prevent flash
      initSettings();

      document.addEventListener("DOMContentLoaded", function () {
        // Settings dropdown toggle
        const settingsToggle = document.querySelector(".settings-toggle");
        if (settingsToggle) {
          settingsToggle.addEventListener("click", toggleSettingsMenu);
        }

        // Theme selection
        document.querySelectorAll(".theme-option").forEach((option) => {
          option.addEventListener("click", function () {
            const theme = this.dataset.theme;
            applyTheme(theme);
            updateSettingsUI();
          });
        });

        // Language selection
        document.querySelectorAll(".language-option").forEach((option) => {
          option.addEventListener("click", function () {
            const lang = this.dataset.lang;
            console.log("Language selected:", lang); // Debug log
            window.userRequestedLanguageChange = true;
            applyLanguage(lang);
            updateSettingsUI();

            // Trigger UI translation update
            document.dispatchEvent(new CustomEvent("languageChanged"));

            // Close settings menu after language selection
            toggleSettingsMenu();
          });
        });

        // Close settings menu when clicking outside
        document.addEventListener("click", closeSettingsOnOutsideClick);

        // Mobile menu toggle
        const mobileMenuToggle = document.querySelector(".mobile-menu-toggle");
        const mobileMenu = document.querySelector(".mobile-menu");

        if (mobileMenuToggle && mobileMenu) {
          mobileMenuToggle.addEventListener("click", function () {
            const isOpen = mobileMenu.classList.contains("open");
            mobileMenu.classList.toggle("open");
            mobileMenuToggle.setAttribute("aria-expanded", !isOpen);
            mobileMenu.setAttribute("aria-hidden", isOpen);
          });
        }

        // Set active navigation links
        const currentPath = window.location.pathname;
        const navLinks = document.querySelectorAll(".nav-link");

        navLinks.forEach((link) => {
          if (link.getAttribute("href") === currentPath) {
            link.classList.add("active");
          }
        });

        // Initialize search functionality
        function initializeSearch(jsonUrl) {
          if (window.SimpleJekyllSearch) {
            console.log("Initializing SimpleJekyllSearch with JSON:", jsonUrl);
            window.simpleJekyllSearch = SimpleJekyllSearch({
              searchInput: document.getElementById("search-input"),
              resultsContainer: document.getElementById("search-results"),
              json: jsonUrl,
              searchResultTemplate:
                '<div class="search-result" data-translate="yes"><a href="{url}" class="result-link"><div class="result-title" data-translate="yes">{title}</div><div class="result-excerpt" data-translate="yes">{content}</div></a></div>',
              middleOfWord: true,
              noResultsText:
                '<div class="search-no-results">No results found</div>',
              limit: 10,
              fuzzy: false,
              exclude: ["Welcome"],
              success: function (data) {
                console.log("Search data loaded successfully:", data);
              },
              error: function (xhr, status, error) {
                console.error("Search data loading failed:", error);
                console.log(
                  "Make sure the site is built and search.json is generated",
                );
              },
            });
          } else {
            console.error("SimpleJekyllSearch not available");
          }
        }

        // Try to initialize search with main JSON file
        initializeSearch('{{ "/search.json" | relative_url }}');

        // Handle search input focus/blur for results container
        const searchInput = document.getElementById("search-input");
        const searchResults = document.getElementById("search-results");

        if (searchInput && searchResults) {
          searchInput.addEventListener("focus", function () {
            if (this.value.trim()) {
              searchResults.style.display = "block";
            }
          });

          searchInput.addEventListener("input", function () {
            if (this.value.trim()) {
              searchResults.style.display = "block";
              // Trigger Google Translate refresh for search results
              setTimeout(() => {
                if (window.i18n && window.i18n.refreshGoogleTranslate) {
                  window.i18n.refreshGoogleTranslate();
                }
              }, 300);
            } else {
              searchResults.style.display = "none";
            }
          });

          // Hide search results when clicking outside
          document.addEventListener("click", function (e) {
            if (
              !searchInput.contains(e.target) &&
              !searchResults.contains(e.target)
            ) {
              searchResults.style.display = "none";
            }
          });
        }
      });
    </script>

    <!-- i18n Helper for UI translations -->
    <script src="{{ '/assets/js/i18n-helper.js' | relative_url }}"></script>

    <!-- Cookie-based Page Activity Analytics -->
    <script>
      /* global screen, navigator, crypto */
      // Cookie utility functions
      function setCookie(name, value, days = 365) {
        const expires = new Date();
        expires.setTime(expires.getTime() + days * 24 * 60 * 60 * 1000);
        document.cookie = `${name}=${value};expires=${expires.toUTCString()};path=/;SameSite=Strict`;
      }

      function getCookie(name) {
        const nameEQ = name + "=";
        const ca = document.cookie.split(";");
        for (let i = 0; i < ca.length; i++) {
          let c = ca[i];
          while (c.charAt(0) === " ") c = c.substring(1, c.length);
          if (c.indexOf(nameEQ) === 0)
            return c.substring(nameEQ.length, c.length);
        }
        return null;
      }

      function generateSecureRandomString(length = 8) {
        // Use cryptographically secure random generation
        if (window.crypto && window.crypto.getRandomValues) {
          const randomBytes = new Uint8Array(Math.ceil((length * 3) / 4)); // More bytes for better base36 conversion
          window.crypto.getRandomValues(randomBytes);
          // Convert to base36 and take desired length
          return Array.from(randomBytes, (byte) =>
            byte.toString(36).padStart(2, "0"),
          )
            .join("")
            .substring(0, length);
        } else {
          // Fallback for very old browsers (though this should be rare in modern web)
          console.warn(
            "Crypto API not available, using timestamp-based fallback",
          );
          return (
            Date.now().toString(36) + Math.floor(performance.now()).toString(36)
          );
        }
      }

      function generateSessionId() {
        return (
          "sess_" +
          generateSecureRandomString(12) +
          "_" +
          Date.now().toString(36)
        );
      }

      function generateUserId() {
        return (
          "user_" +
          generateSecureRandomString(12) +
          "_" +
          Date.now().toString(36)
        );
      }

      // Page activity tracking
      function trackPageActivity() {
        const currentPage = window.location.pathname;
        const timestamp = new Date().toISOString();

        // Get or create user and session IDs
        let userId = getCookie("give_docs_user_id");
        if (!userId) {
          userId = generateUserId();
          setCookie("give_docs_user_id", userId, 365); // 1 year
        }

        let sessionId = getCookie("give_docs_session_id");
        if (!sessionId) {
          sessionId = generateSessionId();
          setCookie("give_docs_session_id", sessionId, 0.5); // 12 hours
        }

        // Track page view
        const pageData = {
          userId: userId,
          sessionId: sessionId,
          page: currentPage,
          title: document.title,
          timestamp: timestamp,
          referrer: document.referrer || "direct",
          userAgent: navigator.userAgent,
          language: navigator.language,
          screenSize: `${screen.width}x${screen.height}`,
          viewportSize: `${window.innerWidth}x${window.innerHeight}`,
        };

        // Store in localStorage for potential analytics export
        try {
          const analyticsData = JSON.parse(
            localStorage.getItem("give_docs_analytics") || "[]",
          );
          analyticsData.push(pageData);

          // Keep only last 100 page views to prevent storage bloat
          if (analyticsData.length > 100) {
            analyticsData.splice(0, analyticsData.length - 100);
          }

          localStorage.setItem(
            "give_docs_analytics",
            JSON.stringify(analyticsData),
          );
        } catch (e) {
          console.warn("Could not store analytics data:", e);
        }

        // Track time on page
        let timeOnPage = 0;
        const startTime = Date.now();

        const trackTimeOnPage = () => {
          timeOnPage = Date.now() - startTime;
          setCookie(
            "give_docs_time_on_page_" +
              currentPage.replace(/[^a-zA-Z0-9]/g, "_"),
            timeOnPage,
            1,
          );
        };

        // Track time on page before leaving
        window.addEventListener("beforeunload", trackTimeOnPage);

        // Also track every 30 seconds for single-page sessions
        setInterval(trackTimeOnPage, 30000);

        // Track scroll depth
        let maxScrollDepth = 0;
        const trackScrollDepth = () => {
          const scrollTop = window.pageYOffset;
          const docHeight = document.body.scrollHeight - window.innerHeight;
          const scrollPercent = Math.round((scrollTop / docHeight) * 100);

          if (scrollPercent > maxScrollDepth) {
            maxScrollDepth = scrollPercent;
            setCookie(
              "give_docs_scroll_depth_" +
                currentPage.replace(/[^a-zA-Z0-9]/g, "_"),
              maxScrollDepth,
              1,
            );
          }
        };

        window.addEventListener("scroll", throttle(trackScrollDepth, 1000));

        // Update visit count
        const visitCount =
          parseInt(getCookie("give_docs_visit_count") || "0") + 1;
        setCookie("give_docs_visit_count", visitCount, 365);

        // Track last visit
        setCookie("give_docs_last_visit", timestamp, 365);

        // Console log for debugging (remove in production)
        console.log("Page activity tracked:", {
          page: currentPage,
          userId: userId.substring(0, 10) + "...",
          sessionId: sessionId.substring(0, 10) + "...",
          visitCount: visitCount,
        });
      }

      // Throttle function to limit scroll tracking frequency
      function throttle(func, limit) {
        let inThrottle;
        return function () {
          const args = arguments;
          const context = this;
          if (!inThrottle) {
            func.apply(context, args);
            inThrottle = true;
            setTimeout(() => (inThrottle = false), limit);
          }
        };
      }

      // Search activity tracking
      function trackSearchActivity(query, resultCount) {
        if (!query || query.trim() === "") return;

        const searchData = {
          userId: getCookie("give_docs_user_id"),
          sessionId: getCookie("give_docs_session_id"),
          query: query.trim(),
          resultCount: resultCount || 0,
          timestamp: new Date().toISOString(),
          page: window.location.pathname,
        };

        try {
          const searchAnalytics = JSON.parse(
            localStorage.getItem("give_docs_search_analytics") || "[]",
          );
          searchAnalytics.push(searchData);

          // Keep only last 50 searches
          if (searchAnalytics.length > 50) {
            searchAnalytics.splice(0, searchAnalytics.length - 50);
          }

          localStorage.setItem(
            "give_docs_search_analytics",
            JSON.stringify(searchAnalytics),
          );
        } catch (e) {
          console.warn("Could not store search analytics:", e);
        }
      }

      // Hook into existing search functionality
      document.addEventListener("DOMContentLoaded", function () {
        // Track page activity
        trackPageActivity();

        // Hook into search input
        const searchInput = document.getElementById("search-input");
        if (searchInput) {
          let searchTimeout;
          searchInput.addEventListener("input", function () {
            clearTimeout(searchTimeout);
            searchTimeout = setTimeout(() => {
              const query = this.value.trim();
              if (query.length >= 2) {
                // Count search results
                const resultsContainer =
                  document.getElementById("search-results");
                const resultCount = resultsContainer
                  ? resultsContainer.querySelectorAll(".search-result").length
                  : 0;
                trackSearchActivity(query, resultCount);
              }
            }, 1000); // Wait 1 second after user stops typing
          });
        }

        // Track navigation clicks
        document.addEventListener("click", function (e) {
          const link = e.target.closest("a");
          if (link && link.href) {
            const linkData = {
              userId: getCookie("give_docs_user_id"),
              sessionId: getCookie("give_docs_session_id"),
              from: window.location.pathname,
              to: link.getAttribute("href"),
              linkText: link.textContent.trim(),
              timestamp: new Date().toISOString(),
              isExternal: link.hostname !== window.location.hostname,
            };

            try {
              const navAnalytics = JSON.parse(
                localStorage.getItem("give_docs_navigation_analytics") || "[]",
              );
              navAnalytics.push(linkData);

              // Keep only last 50 navigation events
              if (navAnalytics.length > 50) {
                navAnalytics.splice(0, navAnalytics.length - 50);
              }

              localStorage.setItem(
                "give_docs_navigation_analytics",
                JSON.stringify(navAnalytics),
              );
            } catch (e) {
              console.warn("Could not store navigation analytics:", e);
            }
          }
        });

        // Track settings changes
        document
          .querySelectorAll(".theme-option, .language-option")
          .forEach((option) => {
            option.addEventListener("click", function () {
              const settingType = this.classList.contains("theme-option")
                ? "theme"
                : "language";
              const settingValue = this.dataset.theme || this.dataset.lang;

              const settingData = {
                userId: getCookie("give_docs_user_id"),
                sessionId: getCookie("give_docs_session_id"),
                settingType: settingType,
                settingValue: settingValue,
                timestamp: new Date().toISOString(),
                page: window.location.pathname,
              };

              try {
                const settingsAnalytics = JSON.parse(
                  localStorage.getItem("give_docs_settings_analytics") || "[]",
                );
                settingsAnalytics.push(settingData);

                // Keep only last 25 settings changes
                if (settingsAnalytics.length > 25) {
                  settingsAnalytics.splice(0, settingsAnalytics.length - 25);
                }

                localStorage.setItem(
                  "give_docs_settings_analytics",
                  JSON.stringify(settingsAnalytics),
                );
              } catch (e) {
                console.warn("Could not store settings analytics:", e);
              }
            });
          });
      });

      // Export analytics data function (for debugging/analysis)
      window.exportAnalytics = function () {
        const data = {
          pageViews: JSON.parse(
            localStorage.getItem("give_docs_analytics") || "[]",
          ),
          searches: JSON.parse(
            localStorage.getItem("give_docs_search_analytics") || "[]",
          ),
          navigation: JSON.parse(
            localStorage.getItem("give_docs_navigation_analytics") || "[]",
          ),
          settings: JSON.parse(
            localStorage.getItem("give_docs_settings_analytics") || "[]",
          ),
          exportedAt: new Date().toISOString(),
        };

        console.log("Documentation Analytics Data:", data);

        // Create downloadable JSON file
        const blob = new Blob([JSON.stringify(data, null, 2)], {
          type: "application/json",
        });
        const url = URL.createObjectURL(blob);
        const a = document.createElement("a");
        a.href = url;
        a.download = `give-docs-analytics-${new Date().toISOString().split("T")[0]}.json`;
        document.body.appendChild(a);
        a.click();
        document.body.removeChild(a);
        URL.revokeObjectURL(url);

        return data;
      };
    </script>
  </body>
</html>
